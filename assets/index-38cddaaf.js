import{r as o,j as t,k as U,l as P,N as k,S as L,B as w,L as M}from"./index-f0759db8.js";import{C as V}from"./card-cc5931f3.js";import{u as v}from"./store-d685386f.js";import{T as B}from"./trash-2-fc86cc4e.js";import{C as b,a as T}from"./chevron-up-8ce33b45.js";const F=60,y=48,G=45,O=45,W=o.createContext(null);function C({children:r,value:c,onChange:u}){const[m,x]=o.useState(0),[p,f]=o.useState([]),j=o.useRef(null);o.useEffect(()=>{if(c===void 0)return;const n=p.indexOf(c);n!==-1&&x(-n*y)},[c,p]);const a=(n,s)=>{f(S=>{const N=[...S];return N[n]=s,N})},d=n=>{j.current=m+n.touches[0].clientY},h=n=>{if(j.current===null)return;const s=j.current-n.touches[0].clientY;x(s)},E=()=>{j.current=null;const n=-Math.round(m/y);x(-n*y);const s=p[n];u==null||u(s)};return t.jsx(W.Provider,{value:{delta:m,onTouchStart:d,onTouchMove:h,onTouchEnd:E,registerItem:a},children:r})}const $=()=>{const r=o.useContext(W);if(!r)throw new Error("useWheelInput must be used within a WheelInput");return r};function A({className:r,children:c,...u}){const{onTouchStart:m,onTouchMove:x,onTouchEnd:p}=$();return t.jsx("ul",{...u,className:U("relative h-32 w-full overflow-hidden border first-of-type:rounded-l-xl last-of-type:rounded-r-xl",r),onTouchStart:m,onTouchMove:x,onTouchEnd:p,children:c})}function D({value:r,className:c,children:u,...m}){const{delta:x,registerItem:p}=$(),[f,j]=o.useState(null),a=o.useMemo(()=>{var E;if(f===null)return null;const d=f.parentElement;if(d===null)return null;const h=(E=d==null?void 0:d.parentElement)==null?void 0:E.children;return h===void 0?null:Array.from(h).indexOf(d)},[f]);return o.useEffect(()=>{a!==null&&p(a,r)},[a,r]),o.useEffect(()=>{if(f===null||a===null)return;const d=x/y,h=Y(-90,d*O+a*G,90);f.style.setProperty("transform",`rotateX(${h}deg) translate3d(0px, 0px, ${F}px)`)},[f,a,x]),t.jsx("li",{className:"absolute left-0 top-1/2 w-full -translate-y-1/2",style:{height:y},children:t.jsx("div",{className:U("absolute left-0 top-0 flex w-full items-center justify-center transition-transform duration-75 [transform-style:_preserve-3d;]",c),...m,style:{height:y},ref:j,children:u||r})})}function Y(r,c,u){return Math.max(r,Math.min(u,c))}function Q(){const r=P(),c=v(e=>e.routines),u=v(e=>e.actualRoutineExecutionId),m=v(e=>e.setActualRoutineExecutionId),x=v(e=>e.addRoutineExecution),p=v(e=>e.addExerciseExecution),f=v(e=>e.addSetExecution),j=v(e=>e.removeSetExecution),[a,d]=o.useState(null),[h,E]=o.useState(null),n=o.useMemo(()=>{const e=c.find(i=>i.id===r.routineId);return e||null},[r.routineId,c]),s=o.useMemo(()=>{if(!n)return null;const e=n.exercises.find(i=>i.id===r.exerciseId);return e||null},[r.exerciseId,n]),S=o.useMemo(()=>{if(!n)return null;const e=n.exercises.findIndex(g=>g.id===r.exerciseId);if(e===-1)return null;const i=n==null?void 0:n.exercises[e-1];return i?i.id:null},[r.exerciseId,n]),N=o.useMemo(()=>{if(!n)return null;const e=n.exercises.findIndex(g=>g.id===r.exerciseId);if(e===-1)return null;const i=n==null?void 0:n.exercises[e+1];return i?i.id:null},[r.exerciseId,n]),I=o.useMemo(()=>{if(!n||!u)return null;const e=n.executions.find(g=>g.id===u);if(e)return e;const i={id:u,exercises:[]};return x(n.id,i),i},[n,u]),l=o.useMemo(()=>{if(!n||!I||!s)return null;const e=I.exercises.find(g=>g.exerciseId===s.id);if(e)return e;const i={id:crypto.randomUUID(),exerciseId:s.id,sets:[]};return p(n.id,I.id,i),i},[I,s]),R=o.useMemo(()=>!s||!l?null:s.sets-l.sets.length,[s==null?void 0:s.sets,l==null?void 0:l.sets.length]);o.useEffect(()=>{u===null&&m(crypto.randomUUID())},[u]),o.useEffect(()=>{if(!s||!l)return;const e=l.sets[(l==null?void 0:l.sets.length)-1];d((e==null?void 0:e.weight)||s.weight),E((e==null?void 0:e.reps)||s.reps)},[s]);const _=()=>{if(!n||!I||!l||a===null||h===null)return null;f(n.id,I.id,l.id,{id:crypto.randomUUID(),weight:a,reps:h})},z=e=>{if(!n||!I||!l)return null;j(n.id,I.id,l.id,e)};return!n||!s?t.jsx(k,{to:".."}):t.jsxs(L,{className:"gap-3",children:[t.jsxs("div",{className:"flex flex-row flex-wrap items-baseline justify-between gap-2",children:[t.jsx("h3",{className:"text-2xl",children:s==null?void 0:s.name}),t.jsxs("p",{className:"text-foreground/50",children:[s.sets,"x",s.reps," ",s.weight&&`${s.weight}Kg`]})]}),t.jsx("hr",{}),t.jsx("div",{className:"flex h-0 grow flex-col gap-2 overflow-auto px-4",children:l==null?void 0:l.sets.map((e,i)=>t.jsxs(V,{className:"flex flex-row items-center gap-3 py-2 pl-6 pr-2",children:[t.jsxs("span",{children:[i+1," Serie"]}),t.jsx("div",{className:"grow"}),t.jsxs("span",{children:[e.reps,"Reps ",e.weight,"Kg"]}),t.jsx(w,{type:"button",variant:"outline",size:"icon",onClick:()=>z(e.id),children:t.jsx(B,{})})]},e.id))}),R!==null&&R>0&&t.jsx("p",{className:"text-center text-foreground/50",children:R===1?"Falta 1 Serie":`Faltan ${R} Series`}),t.jsxs("div",{className:"grid grid-cols-2",children:[t.jsx("span",{className:"text-center",children:"Peso"}),t.jsx("span",{className:"text-center",children:"Repeticiones"}),t.jsx(C,{value:a??0,onChange:d,children:t.jsx(A,{children:Array.from({length:200},(e,i)=>t.jsx(D,{value:i/2},i))})}),t.jsx(C,{value:h??0,onChange:E,children:t.jsx(A,{children:Array.from({length:99},(e,i)=>t.jsx(D,{value:i+1},i))})})]}),t.jsxs("div",{className:"flex flex-row gap-2 pt-4",children:[S?t.jsx(w,{type:"button",variant:"outline",size:"icon",asChild:!0,children:t.jsx(M,{to:`/execute/${r.routineId}/${S}`,children:t.jsx(b,{})})}):t.jsx(w,{type:"button",variant:"outline",size:"icon",asChild:!0,disabled:!0,children:t.jsx(b,{})}),N?t.jsx(w,{type:"button",variant:"outline",size:"icon",asChild:!0,children:t.jsx(M,{to:`/execute/${r.routineId}/${N}`,children:t.jsx(T,{})})}):t.jsx(w,{type:"button",variant:"outline",size:"icon",asChild:!0,disabled:!0,children:t.jsx(T,{})}),t.jsx(w,{type:"button",variant:"default",className:"w-full grow",onClick:_,children:"Agregar Serie"})]})]})}export{Q as default};
