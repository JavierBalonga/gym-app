import{l as M,u as O,r as u,j as t,N as $,B as m,L as T,O as U}from"./index-c430a3d6.js";import{C as k}from"./card-17c75cc4.js";import{u as d}from"./store-cf580411.js";import{S as A,a as D}from"./sheet-6c04f893.js";import{T as K}from"./trash-2-1b7c78d3.js";import"./index-0c08acae.js";function G(){const f=M(),g=O(),j=d(e=>e.routines),o=d(e=>e.actualRoutineExecutionId),I=d(e=>e.setActualRoutineExecutionId),N=d(e=>e.addRoutineExecution),R=d(e=>e.addExerciseExecution),S=d(e=>e.removeSetExecution),[y,E]=u.useState(!0),n=u.useMemo(()=>{const e=j.find(i=>i.id===f.routineId);return e||null},[f.routineId,j]),s=u.useMemo(()=>{if(!n)return null;const e=n.exercises.find(i=>i.id===f.exerciseId);return e||null},[f.exerciseId,n]),c=u.useMemo(()=>{if(!n||!o)return null;const e=n.executions.find(a=>a.id===o);if(e)return e;const i={id:o,exercises:[]};return N(n.id,i),i},[n,o]),r=u.useMemo(()=>{if(!n||!c||!s)return null;const e=c.exercises.find(a=>a.exerciseId===s.id);if(e)return e;const i={id:crypto.randomUUID(),exerciseId:s.id,sets:[]};return R(n.id,c.id,i),i},[c,s]),x=u.useMemo(()=>{if(!n||!o||!s)return null;const e=n.executions.findIndex(l=>l.id===o);if(e===-1)return null;const i=n.executions[e-1];if(!i)return null;const a=i.exercises.find(l=>l.exerciseId===s.id);if(!a)return null;const h=a.sets.length;let w=0,v=0;return a.sets.forEach(l=>{w+=l.weight,v+=l.reps}),{sets:h,weight:w/h,reps:v/h}},[n,o,s]),p=u.useMemo(()=>!s||!r?null:s.sets-r.sets.length,[s==null?void 0:s.sets,r==null?void 0:r.sets.length]);u.useEffect(()=>{o===null&&I(crypto.randomUUID())},[o]);const C=e=>{if(!n||!c||!r)return null;S(n.id,c.id,r.id,e)},b=e=>{e||(E(!1),setTimeout(()=>g(".."),200))},F=()=>{E(!1),setTimeout(()=>g(".."),200)};return!n||!s?t.jsx($,{to:".."}):t.jsxs(t.Fragment,{children:[t.jsx(A,{open:y,onOpenChange:b,children:t.jsxs(D,{children:[t.jsxs("div",{className:"flex flex-row flex-wrap items-baseline justify-between gap-2 pt-6 text-foreground",children:[t.jsx("h3",{className:"text-2xl",children:s==null?void 0:s.name}),t.jsxs("p",{children:[s.sets,"x",s.reps," ",s.weight&&`${s.weight}Kg`]})]}),t.jsx("hr",{}),x&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex flex-row flex-wrap items-baseline justify-between gap-2 text-foreground/50",children:[t.jsx("h4",{className:"text-md",children:"Ejecucion anterior"}),t.jsxs("p",{children:[x.sets,"x",x.reps," ",x.weight&&`${x.weight}Kg`]})]}),t.jsx("hr",{})]}),t.jsx("div",{className:"flex h-0 grow flex-col gap-2 overflow-auto px-4",children:r==null?void 0:r.sets.map((e,i)=>t.jsxs(k,{className:"flex flex-row items-center gap-3 py-2 pl-6 pr-2",children:[t.jsxs("span",{children:[i+1," Serie"]}),t.jsx("div",{className:"grow"}),t.jsxs("span",{children:[e.reps,"Reps ",e.weight,"Kg"]}),t.jsx(m,{type:"button",variant:"outline",size:"icon",onClick:()=>C(e.id),children:t.jsx(K,{})})]},e.id))}),p!==null&&p>0&&t.jsx("p",{className:"text-center text-foreground/50",children:p===1?"Falta 1 Serie":`Faltan ${p} Series`}),t.jsxs("div",{className:"flex flex-row gap-2 pt-4",children:[t.jsx(m,{type:"button",variant:"outline",className:"w-full grow",onClick:F,children:"Finalizar Ejercicio"}),t.jsx(m,{type:"button",variant:"default",className:"w-full grow",asChild:!0,children:t.jsx(T,{to:`/execute/${n.id}/${s.id}/add-serie`,children:"Agregar Serie"})})]})]})}),t.jsx(U,{})]})}export{G as default};
