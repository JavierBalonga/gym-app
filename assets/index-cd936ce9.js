import{r,j as n,k as _,l as U,u as G,B as C,L as V}from"./index-c430a3d6.js";import{D as Y,a as k,b as B,c as F,d as H,e as $}from"./dialog-0e9c9496.js";import{u as M}from"./store-cf580411.js";import"./index-0c08acae.js";const X=60,T=48,q=45,z=45,J=2,O=r.createContext(null);function D({children:o,value:a,onChange:d}){const[m,f]=r.useState(0),[i,x]=r.useState([]),g=r.useRef(null),l=r.useRef(null);r.useEffect(()=>{if(a===void 0)return;const t=i.indexOf(a);t!==-1&&f(-t*T)},[a,i]);const c=(t,u)=>{x(I=>{const h=[...I];return h[t]=u,h})},p=t=>{g.current=m,l.current=t.touches[0].clientY},E=t=>{if(g.current===null||l.current===null)return;const u=g.current+(l.current-t.touches[0].clientY)*J;f(u)},v=()=>{g.current=null,l.current=null;const t=-Math.round(m/T);f(-t*T);const u=i[t];d==null||d(u)};return n.jsx(O.Provider,{value:{delta:m,onTouchStart:p,onTouchMove:E,onTouchEnd:v,registerItem:c},children:o})}const b=()=>{const o=r.useContext(O);if(!o)throw new Error("useWheelInput must be used within a WheelInput");return o};function N({className:o,children:a,...d}){const{onTouchStart:m,onTouchMove:f,onTouchEnd:i}=b();return n.jsx("ul",{...d,className:_("relative h-32 w-full overflow-hidden border first-of-type:rounded-l-xl last-of-type:rounded-r-xl",o),onTouchStart:m,onTouchMove:f,onTouchEnd:i,children:a})}function W({value:o,className:a,children:d,...m}){const{delta:f,registerItem:i}=b(),[x,g]=r.useState(null),l=r.useMemo(()=>{var E;if(x===null)return null;const c=x.parentElement;if(c===null)return null;const p=(E=c==null?void 0:c.parentElement)==null?void 0:E.children;return p===void 0?null:Array.from(p).indexOf(c)},[x]);return r.useEffect(()=>{l!==null&&i(l,o)},[l,o]),r.useEffect(()=>{if(x===null||l===null)return;const c=f/T,p=K(-90,c*z+l*q,90);x.style.setProperty("transform",`rotateX(${p}deg) translate3d(0px, 0px, ${X}px)`)},[x,l,f]),n.jsx("li",{className:"absolute left-0 top-1/2 w-full -translate-y-1/2",style:{height:T},children:n.jsx("div",{className:_("absolute left-0 top-0 flex w-full items-center justify-center transition-transform duration-75 [transform-style:_preserve-3d;]",a),...m,style:{height:T},ref:g,children:d||o})})}function K(o,a,d){return Math.max(o,Math.min(d,a))}function ne(){const o=U(),a=G(),[d,m]=r.useState(!0),f=M(e=>e.routines),i=M(e=>e.actualRoutineExecutionId),x=M(e=>e.addRoutineExecution),g=M(e=>e.addExerciseExecution),l=M(e=>e.addSetExecution),[c,p]=r.useState(null),[E,v]=r.useState(null),t=r.useMemo(()=>{const e=f.find(s=>s.id===o.routineId);return e||null},[o.routineId,f]),u=r.useMemo(()=>{if(!t)return null;const e=t.exercises.find(s=>s.id===o.exerciseId);return e||null},[o.exerciseId,t]),I=r.useMemo(()=>{if(!t||!i)return null;const e=t.executions.find(j=>j.id===i);if(e)return e;const s={id:i,exercises:[]};return x(t.id,s),s},[t,i]),h=r.useMemo(()=>{if(!t||!I||!u)return null;const e=I.exercises.find(j=>j.exerciseId===u.id);if(e)return e;const s={id:crypto.randomUUID(),exerciseId:u.id,sets:[]};return g(t.id,I.id,s),s},[I,u]),w=r.useMemo(()=>{if(!t||!i||!u)return null;const e=t.executions.findIndex(R=>R.id===i);if(e===-1)return null;const s=t.executions[e-1];if(!s)return null;const j=s.exercises.find(R=>R.exerciseId===u.id);if(!j)return null;const y=j.sets.length;let S=0,A=0;return j.sets.forEach(R=>{S+=R.weight,A+=R.reps}),{sets:y,weight:S/y,reps:A/y}},[t,i,u]),P=e=>{e||(m(!1),setTimeout(()=>a(".."),200))};r.useEffect(()=>{if(!u||!h)return;const e=h.sets[(h==null?void 0:h.sets.length)-1];p((e==null?void 0:e.weight)||(w==null?void 0:w.weight)||u.weight),v((e==null?void 0:e.reps)||(w==null?void 0:w.reps)||u.reps)},[u]);const L=()=>{if(!t||!I||!h||c===null||E===null)return null;l(t.id,I.id,h.id,{id:crypto.randomUUID(),weight:c,reps:E}),a("..")};return n.jsx(Y,{open:d,onOpenChange:P,children:n.jsxs(k,{children:[n.jsxs(B,{children:[n.jsx(F,{children:"Agregar Serie"}),n.jsxs(H,{className:"grid grid-cols-2",children:[n.jsx("span",{className:"text-center",children:"Peso"}),n.jsx("span",{className:"text-center",children:"Repeticiones"}),n.jsx(D,{value:c??0,onChange:p,children:n.jsx(N,{children:Array.from({length:200},(e,s)=>n.jsx(W,{value:s/2},s))})}),n.jsx(D,{value:E??0,onChange:v,children:n.jsx(N,{children:Array.from({length:99},(e,s)=>n.jsx(W,{value:s+1},s))})})]})]}),n.jsxs($,{className:"grid grid-cols-2",children:[n.jsx(C,{variant:"outline",asChild:!0,children:n.jsx(V,{to:"..",children:"Cancelar"})}),n.jsx(C,{onClick:L,children:"Guardar"})]})]})})}export{ne as default};
