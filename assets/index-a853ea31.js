import{r as s,j as t,k as U,l as B,u as G,N as K,B as A}from"./index-ff1b1397.js";import{C as L}from"./card-fa38b110.js";import{u as S}from"./store-eb5226e2.js";import{S as z,a as H}from"./sheet-6a15bebe.js";import{T as X}from"./trash-2-e28ceb8e.js";import"./index-4d813205.js";const q=60,y=48,J=45,Q=45,Z=4,P=s.createContext(null);function _({children:i,value:d,onChange:x}){const[l,m]=s.useState(0),[g,p]=s.useState([]),w=s.useRef(null),a=s.useRef(null);s.useEffect(()=>{if(d===void 0)return;const c=g.indexOf(d);c!==-1&&m(-c*y)},[d,g]);const f=(c,I)=>{p(r=>{const n=[...r];return n[c]=I,n})},j=c=>{w.current=l,a.current=c.touches[0].clientY},E=c=>{if(w.current===null||a.current===null)return;const I=w.current+(a.current-c.touches[0].clientY)*Z;m(I)},T=()=>{w.current=null,a.current=null;const c=-Math.round(l/y);m(-c*y);const I=g[c];x==null||x(I)};return t.jsx(P.Provider,{value:{delta:l,onTouchStart:j,onTouchMove:E,onTouchEnd:T,registerItem:f},children:i})}const D=()=>{const i=s.useContext(P);if(!i)throw new Error("useWheelInput must be used within a WheelInput");return i};function F({className:i,children:d,...x}){const{onTouchStart:l,onTouchMove:m,onTouchEnd:g}=D();return t.jsx("ul",{...x,className:U("relative h-32 w-full overflow-hidden border first-of-type:rounded-l-xl last-of-type:rounded-r-xl",i),onTouchStart:l,onTouchMove:m,onTouchEnd:g,children:d})}function O({value:i,className:d,children:x,...l}){const{delta:m,registerItem:g}=D(),[p,w]=s.useState(null),a=s.useMemo(()=>{var E;if(p===null)return null;const f=p.parentElement;if(f===null)return null;const j=(E=f==null?void 0:f.parentElement)==null?void 0:E.children;return j===void 0?null:Array.from(j).indexOf(f)},[p]);return s.useEffect(()=>{a!==null&&g(a,i)},[a,i]),s.useEffect(()=>{if(p===null||a===null)return;const f=m/y,j=ee(-90,f*Q+a*J,90);p.style.setProperty("transform",`rotateX(${j}deg) translate3d(0px, 0px, ${q}px)`)},[p,a,m]),t.jsx("li",{className:"absolute left-0 top-1/2 w-full -translate-y-1/2",style:{height:y},children:t.jsx("div",{className:U("absolute left-0 top-0 flex w-full items-center justify-center transition-transform duration-75 [transform-style:_preserve-3d;]",d),...l,style:{height:y},ref:w,children:x||i})})}function ee(i,d,x){return Math.max(i,Math.min(x,d))}function le(){const i=B(),d=G(),x=S(e=>e.routines),l=S(e=>e.actualRoutineExecutionId),m=S(e=>e.setActualRoutineExecutionId),g=S(e=>e.addRoutineExecution),p=S(e=>e.addExerciseExecution),w=S(e=>e.addSetExecution),a=S(e=>e.removeSetExecution),[f,j]=s.useState(!0),[E,T]=s.useState(null),[c,I]=s.useState(null),r=s.useMemo(()=>{const e=x.find(o=>o.id===i.routineId);return e||null},[i.routineId,x]),n=s.useMemo(()=>{if(!r)return null;const e=r.exercises.find(o=>o.id===i.exerciseId);return e||null},[i.exerciseId,r]),v=s.useMemo(()=>{if(!r||!l)return null;const e=r.executions.find(N=>N.id===l);if(e)return e;const o={id:l,exercises:[]};return g(r.id,o),o},[r,l]),u=s.useMemo(()=>{if(!r||!v||!n)return null;const e=v.exercises.find(N=>N.exerciseId===n.id);if(e)return e;const o={id:crypto.randomUUID(),exerciseId:n.id,sets:[]};return p(r.id,v.id,o),o},[v,n]),h=s.useMemo(()=>{if(!r||!l||!n)return null;const e=r.executions.findIndex(R=>R.id===l);if(e===-1)return null;const o=r.executions[e-1];if(!o)return null;const N=o.exercises.find(R=>R.exerciseId===n.id);if(!N)return null;const C=N.sets.length;let b=0,W=0;return N.sets.forEach(R=>{b+=R.weight,W+=R.reps}),{sets:C,weight:b/C,reps:W/C}},[r,l,n]),M=s.useMemo(()=>!n||!u?null:n.sets-u.sets.length,[n==null?void 0:n.sets,u==null?void 0:u.sets.length]);s.useEffect(()=>{l===null&&m(crypto.randomUUID())},[l]),s.useEffect(()=>{if(!n||!u)return;const e=u.sets[(u==null?void 0:u.sets.length)-1];T((e==null?void 0:e.weight)||(h==null?void 0:h.weight)||n.weight),I((e==null?void 0:e.reps)||(h==null?void 0:h.reps)||n.reps)},[n]);const $=()=>{if(!r||!v||!u||E===null||c===null)return null;w(r.id,v.id,u.id,{id:crypto.randomUUID(),weight:E,reps:c})},k=e=>{if(!r||!v||!u)return null;a(r.id,v.id,u.id,e)},V=e=>{e||(j(!1),setTimeout(()=>d(".."),200))},Y=()=>{j(!1),setTimeout(()=>d(".."),200)};return!r||!n?t.jsx(K,{to:".."}):t.jsx(z,{open:f,onOpenChange:V,children:t.jsxs(H,{children:[t.jsxs("div",{className:"flex flex-row flex-wrap items-baseline justify-between gap-2 pt-6 text-foreground",children:[t.jsx("h3",{className:"text-2xl",children:n==null?void 0:n.name}),t.jsxs("p",{children:[n.sets,"x",n.reps," ",n.weight&&`${n.weight}Kg`]})]}),t.jsx("hr",{}),h&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex flex-row flex-wrap items-baseline justify-between gap-2 text-foreground/50",children:[t.jsx("h4",{className:"text-md",children:"Ejecucion anterior"}),t.jsxs("p",{children:[h.sets,"x",h.reps," ",h.weight&&`${h.weight}Kg`]})]}),t.jsx("hr",{})]}),t.jsx("div",{className:"flex h-0 grow flex-col gap-2 overflow-auto px-4",children:u==null?void 0:u.sets.map((e,o)=>t.jsxs(L,{className:"flex flex-row items-center gap-3 py-2 pl-6 pr-2",children:[t.jsxs("span",{children:[o+1," Serie"]}),t.jsx("div",{className:"grow"}),t.jsxs("span",{children:[e.reps,"Reps ",e.weight,"Kg"]}),t.jsx(A,{type:"button",variant:"outline",size:"icon",onClick:()=>k(e.id),children:t.jsx(X,{})})]},e.id))}),M!==null&&M>0&&t.jsx("p",{className:"text-center text-foreground/50",children:M===1?"Falta 1 Serie":`Faltan ${M} Series`}),t.jsxs("div",{className:"grid grid-cols-2",children:[t.jsx("span",{className:"text-center",children:"Peso"}),t.jsx("span",{className:"text-center",children:"Repeticiones"}),t.jsx(_,{value:E??0,onChange:T,children:t.jsx(F,{children:Array.from({length:200},(e,o)=>t.jsx(O,{value:o/2},o))})}),t.jsx(_,{value:c??0,onChange:I,children:t.jsx(F,{children:Array.from({length:99},(e,o)=>t.jsx(O,{value:o+1},o))})})]}),t.jsxs("div",{className:"flex flex-row gap-2 pt-4",children:[t.jsx(A,{type:"button",variant:"outline",className:"w-full grow",onClick:Y,children:"Finalizar Ejercicio"}),t.jsx(A,{type:"button",variant:"default",className:"w-full grow",onClick:$,children:"Agregar Serie"})]})]})})}export{le as default};
